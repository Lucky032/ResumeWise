{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user account in the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "User's display name or full name."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile photo (optional).",
          "format": "uri"
        },
        "subscription": {
          "type": "string",
          "description": "User's subscription type: free or pro.",
          "format": "string"
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Timestamp of when the user account was last updated.",
          "format": "date-time"
        },
        "preferences": {
          "type": "string",
          "description": "User's preferences.",
          "format": "string"
        }
      },
      "required": [
        "id",
        "email",
        "displayName",
        "createdAt",
        "updatedAt"
      ]
    },
    "Resume": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Resume",
      "type": "object",
      "description": "Represents a user's resume.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the resume entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Resume)"
        },
        "title": {
          "type": "string",
          "description": "Title of the resume (e.g., 'Main Resume', 'Tech Role Resume')."
        },
        "templateId": {
          "type": "string",
          "description": "Reference to Template. (Relationship: Template 1:N Resume)"
        },
        "content": {
          "type": "string",
          "description": "Serialized content of the resume."
        },
        "design": {
          "type": "string",
          "description": "Serialized design settings for the resume."
        },
        "visibility": {
          "type": "string",
          "description": "Serialized visibility settings for the resume."
        },
        "metadata": {
          "type": "string",
          "description": "Serialized metadata about the resume."
        }
      },
      "required": [
        "id",
        "userId",
        "title",
        "templateId",
        "content",
        "design",
        "visibility",
        "metadata"
      ]
    },
    "Template": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Template",
      "type": "object",
      "description": "Represents a resume template.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the template entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the template (e.g., 'Modern Clean')."
        },
        "category": {
          "type": "string",
          "description": "Category of the template (e.g., 'modern')."
        },
        "layout": {
          "type": "string",
          "description": "Layout type of the template (e.g., 'two-column')."
        },
        "cssTemplate": {
          "type": "string",
          "description": "CSS styling for the template."
        },
        "htmlStructure": {
          "type": "string",
          "description": "HTML structure of the template."
        },
        "previewImageUrl": {
          "type": "string",
          "description": "URL of the template's preview image.",
          "format": "uri"
        },
        "isPremium": {
          "type": "boolean",
          "description": "Indicates whether the template is a premium template."
        }
      },
      "required": [
        "id",
        "name",
        "category",
        "layout",
        "cssTemplate",
        "htmlStructure",
        "previewImageUrl",
        "isPremium"
      ]
    },
    "SharedResume": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "SharedResume",
      "type": "object",
      "description": "Represents a shared resume link.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the shared resume link entity."
        },
        "resumeId": {
          "type": "string",
          "description": "Reference to Resume. (Relationship: Resume 1:N SharedResume)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N SharedResume)"
        },
        "shareToken": {
          "type": "string",
          "description": "Unique token for sharing the resume."
        },
        "password": {
          "type": "string",
          "description": "Optional password for protecting the shared resume."
        },
        "expiresAt": {
          "type": "string",
          "description": "Timestamp of when the shared link expires.",
          "format": "date-time"
        },
        "viewCount": {
          "type": "number",
          "description": "Number of times the shared resume has been viewed."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp of when the shared link was created.",
          "format": "date-time"
        },
        "comments": {
          "type": "string",
          "description": "Serialized comments on the shared resume."
        }
      },
      "required": [
        "id",
        "resumeId",
        "userId",
        "shareToken",
        "createdAt"
      ]
    },
    "AiUsage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "AiUsage",
      "type": "object",
      "description": "Represents AI usage tracking for a user on a specific date.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AI usage entity.  Combination of userId and date."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N AiUsage)"
        },
        "date": {
          "type": "string",
          "description": "Date for which AI usage is being tracked (YYYY-MM-DD)."
        },
        "summaryRequests": {
          "type": "number",
          "description": "Number of summary generation requests made."
        },
        "bulletRequests": {
          "type": "number",
          "description": "Number of bullet point generation requests made."
        },
        "enhanceRequests": {
          "type": "number",
          "description": "Number of bullet point enhancement requests made."
        },
        "totalTokensUsed": {
          "type": "number",
          "description": "Total number of tokens used for AI requests."
        },
        "estimatedCost": {
          "type": "number",
          "description": "Estimated cost of AI usage."
        }
      },
      "required": [
        "id",
        "userId",
        "date",
        "summaryRequests",
        "bulletRequests",
        "totalTokensUsed"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information. Includes standard user details, creation timestamps, and preferences. The document ID is the user's UID from Firebase Authentication.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, obtained from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/resumes/{resumeId}",
        "definition": {
          "entityName": "Resume",
          "schema": {
            "$ref": "#/backend/entities/Resume"
          },
          "description": "Stores resume data. Includes a reference to the user who owns the resume, resume content, template information, design settings, and visibility settings. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "resumeId",
              "description": "The unique identifier for the resume."
            }
          ]
        }
      },
      {
        "path": "/templates/{templateId}",
        "definition": {
          "entityName": "Template",
          "schema": {
            "$ref": "#/backend/entities/Template"
          },
          "description": "Stores resume template information. Includes template name, category, layout, CSS styling, HTML structure, and preview image URL.",
          "params": [
            {
              "name": "templateId",
              "description": "The unique identifier for the template."
            }
          ]
        }
      },
      {
        "path": "/sharedResumes/{shareToken}",
        "definition": {
          "entityName": "SharedResume",
          "schema": {
            "$ref": "#/backend/entities/SharedResume"
          },
          "description": "Stores shared resume link information. Includes a reference to the resume being shared, the user who created the share link, a unique share token, optional password protection, expiration timestamp, view count, and comments.",
          "params": [
            {
              "name": "shareToken",
              "description": "The unique token for sharing the resume."
            }
          ]
        }
      },
      {
        "path": "/aiUsage/{aiUsageId}",
        "definition": {
          "entityName": "AiUsage",
          "schema": {
            "$ref": "#/backend/entities/AiUsage"
          },
          "description": "Stores AI usage data for a user on a specific date. Includes the user ID, date, number of summary requests, number of bullet point requests, total tokens used, and estimated cost.",
          "params": [
            {
              "name": "aiUsageId",
              "description": "The unique identifier for the AI usage entity, which is a combination of userId and date."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support a resume builder application with AI-powered features, user authentication, and template management, while adhering to the principles of Authorization Independence, Structural Segregation, Access Modeling, and Data Clarity. The structure focuses on path-based ownership for user-specific data and denormalization to avoid hierarchical authorization dependencies.\n\n*   **Authorization Independence:** The design avoids `get()` calls in security rules by denormalizing authorization data. For example, the `Resume` collection includes the `userId` field, which allows direct authorization based on the requesting user's ID without needing to fetch the user document. This is crucial for atomic operations.\n\n*   **Structural Segregation:** Different data types with different access requirements are stored in separate collections. User profiles are stored in `/users/{userId}`, resumes are stored in `/resumes/{resumeId}`, templates are stored in `/templates/{templateId}`, shared resumes are stored in `/sharedResumes/{shareToken}`, and AI usage data are stored in `/aiUsage/{userId}_{date}`. This simplifies security rules by ensuring that all documents in a collection share the same security requirements.\n\n*   **Access Modeling:** Path-based ownership is used for user-owned data such as resumes (`/users/{userId}/resumes/{resumeId}`). Collaborative data is handled through shared resume links (`/sharedResumes/{shareToken}`), which may require additional security measures like passwords.\n\n*   **QAPs (Rules are not Filters):** The structure supports secure `list` operations. For example, listing resumes under `/resumes` is secured by checking if `request.auth.uid == resource.data.userId`, ensuring that only the owner can access their resumes. The segregation of user-owned data into `/users/{userId}/resumes/{resumeId}` further enables secure and efficient list operations.\n\n*   **Global Roles (DBAC):** While not explicitly used in this design, global roles could be implemented using dedicated collections such as `/roles_admin/{uid}` or `/roles_premium/{uid}` to manage administrative or premium access.\n\n*   **Data Clarity and Predictability:** The schema enforces consistent naming conventions (e.g., `userId`, `createdAt`, `updatedAt`) and avoids dynamic keys. Explicit state modeling (e.g., using a `status` field if needed) would further enhance predictability.\n"
  }
}
    